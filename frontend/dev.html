<!DOCTYPE html>
<html>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>BlackMagic - Flash Firmware (DEV)</title>
    <link rel="stylesheet" href="src/styles.css">
    <style>
        .dev-banner {
            background-color: #ff9800;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="dev-banner">‚ö†Ô∏è DEVELOPMENT MODE - Backend is mocked</div>
    <h1>BlackMagic Probe - Firmware Flash</h1>
    <div class='upload-form' id='uploadForm'>
        <h2>Select Firmware File</h2>
        <div class='drop-zone' id='dropZone'>
            <div class='drop-zone-text'>üìÅ Drag & Drop firmware file here</div>
            <div class='drop-zone-hint'>or click to browse</div>
        </div>
        <input type='file' id='fileInput' name='file' accept='.bin,.elf' style='display: none;'>
        <div id='fileInfo' class='file-info' style='display: none;'></div>
        <form id='uploadFormElement' enctype='multipart/form-data'>
            <div class='addr-input'>
                <label for='baseAddr'>Flash Base Address (hex):</label>
                <input type='text' id='baseAddr' value='0x08000000' pattern='0x[0-9A-Fa-f]{8}'>
            </div>
            <button type='submit' id='uploadBtn' disabled>Upload & Flash Target</button>
        </form>
        <div id='status'></div>
        <div class='progress' id='progressContainer' style='display:none;'>
            <div class='progress-bar' id='progressBar'></div>
        </div>
    </div>
    <script>
        // Development mode - mock backend by overriding form submission
        window.addEventListener('DOMContentLoaded', () => {
            const originalScript = document.createElement('script');
            originalScript.src = 'src/app.js';
            
            // Load original app.js
            document.body.appendChild(originalScript);
            
            // Wait for it to load, then override
            originalScript.onload = () => {
                const form = document.getElementById('uploadForm');
                
                // Remove original listener and add mock
                const newForm = form.cloneNode(true);
                form.parentNode.replaceChild(newForm, form);
                
                newForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const fileInput = document.getElementById('fileInput');
                    const file = fileInput.files[0];
                    const uploadBtn = document.getElementById('uploadBtn');
                    
                    if (!file) return;
                    
                    const status = document.getElementById('status');
                    const progressContainer = document.getElementById('progressContainer');
                    const progressBar = document.getElementById('progressBar');
                    
                    uploadBtn.disabled = true;
                    status.textContent = 'Uploading ' + file.name + ' (' + (file.size/1024).toFixed(1) + ' KB)...';
                    status.className = 'info';
                    progressContainer.style.display = 'block';
                    progressBar.style.width = '0%';
                    
                    // Simulate upload progress
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 10;
                        progressBar.style.width = progress + '%';
                        status.textContent = 'Uploading... ' + progress + '%';
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            status.textContent = '‚úì Firmware flashed successfully (MOCKED)';
                            status.className = 'success';
                            uploadBtn.disabled = false;
                        }
                    }, 200);
                });
            };
        });
    </script>
</body>
</html>
